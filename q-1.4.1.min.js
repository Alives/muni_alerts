!function(a){"use strict";if("function"==typeof bootstrap)bootstrap("promise",a);else if("object"==typeof exports&&"object"==typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=a}else{if("undefined"==typeof window&&"undefined"==typeof self)throw new Error("This environment was not anticipated by Q. Please file a bug.");var b="undefined"!=typeof window?window:self,c=b.Q;b.Q=a(),b.Q.noConflict=function(){return b.Q=c,this}}}(function(){"use strict";function g(a){return function(){return f.apply(a,arguments)}}function p(a){return a===Object(a)}function q(a){return"[object StopIteration]"===o(a)||a instanceof r}function t(b,c){if(a&&c.stack&&"object"==typeof b&&null!==b&&b.stack&&b.stack.indexOf(s)===-1){for(var d=[],e=c;e;e=e.source)e.stack&&d.unshift(e.stack);d.unshift(b.stack);var f=d.join("\n"+s+"\n");b.stack=u(f)}}function u(a){for(var b=a.split("\n"),c=[],d=0;d<b.length;++d){var e=b[d];x(e)||v(e)||!e||c.push(e)}return c.join("\n")}function v(a){return a.indexOf("(module.js:")!==-1||a.indexOf("(node.js:")!==-1}function w(a){var b=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(b)return[b[1],Number(b[2])];var c=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a);if(c)return[c[1],Number(c[2])];var d=/.*@(.+):(\d+)$/.exec(a);return d?[d[1],Number(d[2])]:void 0}function x(a){var d=w(a);if(!d)return!1;var e=d[0],f=d[1];return e===c&&f>=b&&f<=ha}function y(){if(a)try{throw new Error}catch(a){var b=a.stack.split("\n"),d=b[0].indexOf("@")>0?b[1]:b[2],e=w(d);if(!e)return;return c=e[0],e[1]}}function z(a,b,c){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(b+" is deprecated, use "+c+" instead.",new Error("").stack),a.apply(a,arguments)}}function A(a){return a instanceof E?a:I(a)?V(a):U(a)}function B(){function g(a){d=a,f.source=a,i(b,function(b,c){A.nextTick(function(){a.promiseDispatch.apply(a,c)})},void 0),b=void 0,c=void 0}var d,b=[],c=[],e=l(B.prototype),f=l(E.prototype);if(f.promiseDispatch=function(a,e,f){var g=h(arguments);b?(b.push(g),"when"===e&&f[1]&&c.push(f[1])):A.nextTick(function(){d.promiseDispatch.apply(d,g)})},f.valueOf=function(){if(b)return f;var a=G(d);return H(a)&&(d=a),a},f.inspect=function(){return d?d.inspect():{state:"pending"}},A.longStackSupport&&a)try{throw new Error}catch(a){f.stack=a.stack.substring(a.stack.indexOf("\n")+1)}return e.promise=f,e.resolve=function(a){d||g(A(a))},e.fulfill=function(a){d||g(U(a))},e.reject=function(a){d||g(T(a))},e.notify=function(a){d||i(c,function(b,c){A.nextTick(function(){c(a)})},void 0)},e}function C(a){if("function"!=typeof a)throw new TypeError("resolver must be a function.");var b=B();try{a(b.resolve,b.reject,b.notify)}catch(a){b.reject(a)}return b.promise}function D(a){return C(function(b,c){for(var d=0,e=a.length;d<e;d++)A(a[d]).then(b,c)})}function E(a,b,c){void 0===b&&(b=function(a){return T(new Error("Promise does not support operation: "+a))}),void 0===c&&(c=function(){return{state:"unknown"}});var d=l(E.prototype);if(d.promiseDispatch=function(c,e,f){var g;try{g=a[e]?a[e].apply(d,f):b.call(d,e,f)}catch(a){g=T(a)}c&&c(g)},d.inspect=c,c){var e=c();"rejected"===e.state&&(d.exception=e.reason),d.valueOf=function(){var a=c();return"pending"===a.state||"rejected"===a.state?d:a.value}}return d}function F(a,b,c,d){return A(a).then(b,c,d)}function G(a){if(H(a)){var b=a.inspect();if("fulfilled"===b.state)return b.value}return a}function H(a){return a instanceof E}function I(a){return p(a)&&"function"==typeof a.then}function J(a){return H(a)&&"pending"===a.inspect().state}function K(a){return!H(a)||"fulfilled"===a.inspect().state}function L(a){return H(a)&&"rejected"===a.inspect().state}function Q(){M.length=0,N.length=0,P||(P=!0)}function R(a,b){P&&("object"==typeof process&&"function"==typeof process.emit&&A.nextTick.runAfter(function(){j(N,a)!==-1&&(process.emit("unhandledRejection",b,a),O.push(a))}),N.push(a),b&&"undefined"!=typeof b.stack?M.push(b.stack):M.push("(no stack) "+b))}function S(a){if(P){var b=j(N,a);b!==-1&&("object"==typeof process&&"function"==typeof process.emit&&A.nextTick.runAfter(function(){var c=j(O,a);c!==-1&&(process.emit("rejectionHandled",M[b],a),O.splice(c,1))}),N.splice(b,1),M.splice(b,1))}}function T(a){var b=E({when:function(b){return b&&S(this),b?b(a):this}},function(){return this},function(){return{state:"rejected",reason:a}});return R(b,a),b}function U(a){return E({when:function(){return a},get:function(b){return a[b]},set:function(b,c){a[b]=c},delete:function(b){delete a[b]},post:function(b,c){return null===b||void 0===b?a.apply(void 0,c):a[b].apply(a,c)},apply:function(b,c){return a.apply(b,c)},keys:function(){return n(a)}},void 0,function(){return{state:"fulfilled",value:a}})}function V(a){var b=B();return A.nextTick(function(){try{a.then(b.resolve,b.reject,b.notify)}catch(a){b.reject(a)}}),b.promise}function W(a){return E({isDef:function(){}},function(c,d){return aa(a,c,d)},function(){return A(a).inspect()})}function X(a,b,c){return A(a).spread(b,c)}function Y(a){return function(){function b(a,b){var f;if("undefined"==typeof StopIteration){try{f=c[a](b)}catch(a){return T(a)}return f.done?A(f.value):F(f.value,d,e)}try{f=c[a](b)}catch(a){return q(a)?A(a.value):T(a)}return F(f,d,e)}var c=a.apply(this,arguments),d=b.bind(b,"next"),e=b.bind(b,"throw");return d()}}function Z(a){A.done(A.async(a)())}function $(a){throw new r(a)}function _(a){return function(){return X([this,ba(arguments)],function(b,c){return a.apply(b,c)})}}function aa(a,b,c){return A(a).dispatch(b,c)}function ba(a){return F(a,function(a){var b=0,c=B();return i(a,function(d,e,f){var g;H(e)&&"fulfilled"===(g=e.inspect()).state?a[f]=g.value:(++b,F(e,function(d){a[f]=d,0===--b&&c.resolve(a)},c.reject,function(a){c.notify({index:f,value:a})}))},void 0),0===b&&c.resolve(a),c.promise})}function ca(a){if(0===a.length)return A.resolve();var b=A.defer(),c=0;return i(a,function(d,e,f){function h(a){b.resolve(a)}function i(){c--,0===c&&b.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))}function j(a){b.notify({index:f,value:a})}var g=a[f];c++,F(g,h,i,j)},void 0),b.promise}function da(a){return F(a,function(a){return a=k(a,A),F(ba(k(a,function(a){return F(a,d,d)})),function(){return a})})}function ea(a){return A(a).allSettled()}function fa(a,b){return A(a).then(void 0,void 0,b)}function ga(a,b){return A(a).nodeify(b)}var a=!1;try{throw new Error}catch(b){a=!!b.stack}var c,r,b=y(),d=function(){},e=function(){function h(){for(var b,d;a.next;)a=a.next,b=a.task,a.task=void 0,d=a.domain,d&&(a.domain=void 0,d.enter()),i(b,d);for(;g.length;)b=g.pop(),i(b);c=!1}function i(a,b){try{a()}catch(a){if(f)throw b&&b.exit(),setTimeout(h,0),b&&b.enter(),a;setTimeout(function(){throw a},0)}b&&b.exit()}var a={task:void 0,next:null},b=a,c=!1,d=void 0,f=!1,g=[];if(e=function(a){b=b.next={task:a,domain:f&&process.domain,next:null},c||(c=!0,d())},"object"==typeof process&&"[object process]"===process.toString()&&process.nextTick)f=!0,d=function(){process.nextTick(h)};else if("function"==typeof setImmediate)d="undefined"!=typeof window?setImmediate.bind(window,h):function(){setImmediate(h)};else if("undefined"!=typeof MessageChannel){var j=new MessageChannel;j.port1.onmessage=function(){d=k,j.port1.onmessage=h,h()};var k=function(){j.port2.postMessage(0)};d=function(){setTimeout(h,0),k()}}else d=function(){setTimeout(h,0)};return e.runAfter=function(a){g.push(a),c||(c=!0,d())},e}(),f=Function.call,h=g(Array.prototype.slice),i=g(Array.prototype.reduce||function(a,b){var c=0,d=this.length;if(1===arguments.length)for(;;){if(c in this){b=this[c++];break}if(++c>=d)throw new TypeError}for(;c<d;c++)c in this&&(b=a(b,this[c],c));return b}),j=g(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),k=g(Array.prototype.map||function(a,b){var c=this,d=[];return i(c,function(e,f,g){d.push(a.call(b,f,g,c))},void 0),d}),l=Object.create||function(a){function b(){}return b.prototype=a,new b},m=g(Object.prototype.hasOwnProperty),n=Object.keys||function(a){var b=[];for(var c in a)m(a,c)&&b.push(c);return b},o=g(Object.prototype.toString);r="undefined"!=typeof ReturnValue?ReturnValue:function(a){this.value=a};var s="From previous event:";A.resolve=A,A.nextTick=e,A.longStackSupport=!1,"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(A.longStackSupport=!0),A.defer=B,B.prototype.makeNodeResolver=function(){var a=this;return function(b,c){b?a.reject(b):arguments.length>2?a.resolve(h(arguments,1)):a.resolve(c)}},A.Promise=C,A.promise=C,C.race=D,C.all=ba,C.reject=T,C.resolve=A,A.passByCopy=function(a){return a},E.prototype.passByCopy=function(){return this},A.join=function(a,b){return A(a).join(b)},E.prototype.join=function(a){return A([this,a]).spread(function(a,b){if(a===b)return a;throw new Error("Can't join: not the same: "+a+" "+b)})},A.race=D,E.prototype.race=function(){return this.then(A.race)},A.makePromise=E,E.prototype.toString=function(){return"[object Promise]"},E.prototype.then=function(a,b,c){function g(b){try{return"function"==typeof a?a(b):b}catch(a){return T(a)}}function h(a){if("function"==typeof b){t(a,d);try{return b(a)}catch(a){return T(a)}}return T(a)}function i(a){return"function"==typeof c?c(a):a}var d=this,e=B(),f=!1;return A.nextTick(function(){d.promiseDispatch(function(a){f||(f=!0,e.resolve(g(a)))},"when",[function(a){f||(f=!0,e.resolve(h(a)))}])}),d.promiseDispatch(void 0,"when",[void 0,function(a){var b,c=!1;try{b=i(a)}catch(a){if(c=!0,!A.onerror)throw a;A.onerror(a)}c||e.notify(b)}]),e.promise},A.tap=function(a,b){return A(a).tap(b)},E.prototype.tap=function(a){return a=A(a),this.then(function(b){return a.fcall(b).thenResolve(b)})},A.when=F,E.prototype.thenResolve=function(a){return this.then(function(){return a})},A.thenResolve=function(a,b){return A(a).thenResolve(b)},E.prototype.thenReject=function(a){return this.then(function(){throw a})},A.thenReject=function(a,b){return A(a).thenReject(b)},A.nearer=G,A.isPromise=H,A.isPromiseAlike=I,A.isPending=J,E.prototype.isPending=function(){return"pending"===this.inspect().state},A.isFulfilled=K,E.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},A.isRejected=L,E.prototype.isRejected=function(){return"rejected"===this.inspect().state};var M=[],N=[],O=[],P=!0;A.resetUnhandledRejections=Q,A.getUnhandledReasons=function(){return M.slice()},A.stopUnhandledRejectionTracking=function(){Q(),P=!1},Q(),A.reject=T,A.fulfill=U,A.master=W,A.spread=X,E.prototype.spread=function(a,b){return this.all().then(function(b){return a.apply(void 0,b)},b)},A.async=Y,A.spawn=Z,A.return=$,A.promised=_,A.dispatch=aa,E.prototype.dispatch=function(a,b){var c=this,d=B();return A.nextTick(function(){c.promiseDispatch(d.resolve,a,b)}),d.promise},A.get=function(a,b){return A(a).dispatch("get",[b])},E.prototype.get=function(a){return this.dispatch("get",[a])},A.set=function(a,b,c){return A(a).dispatch("set",[b,c])},E.prototype.set=function(a,b){return this.dispatch("set",[a,b])},A.del=A.delete=function(a,b){return A(a).dispatch("delete",[b])},E.prototype.del=E.prototype.delete=function(a){return this.dispatch("delete",[a])},A.mapply=A.post=function(a,b,c){return A(a).dispatch("post",[b,c])},E.prototype.mapply=E.prototype.post=function(a,b){return this.dispatch("post",[a,b])},A.send=A.mcall=A.invoke=function(a,b){return A(a).dispatch("post",[b,h(arguments,2)])},E.prototype.send=E.prototype.mcall=E.prototype.invoke=function(a){return this.dispatch("post",[a,h(arguments,1)])},A.fapply=function(a,b){return A(a).dispatch("apply",[void 0,b])},E.prototype.fapply=function(a){return this.dispatch("apply",[void 0,a])},A.try=A.fcall=function(a){return A(a).dispatch("apply",[void 0,h(arguments,1)])},E.prototype.fcall=function(){return this.dispatch("apply",[void 0,h(arguments)])},A.fbind=function(a){var b=A(a),c=h(arguments,1);return function(){return b.dispatch("apply",[this,c.concat(h(arguments))])}},E.prototype.fbind=function(){var a=this,b=h(arguments);return function(){return a.dispatch("apply",[this,b.concat(h(arguments))])}},A.keys=function(a){return A(a).dispatch("keys",[])},E.prototype.keys=function(){return this.dispatch("keys",[])},A.all=ba,E.prototype.all=function(){return ba(this)},A.any=ca,E.prototype.any=function(){return ca(this)},A.allResolved=z(da,"allResolved","allSettled"),E.prototype.allResolved=function(){return da(this)},A.allSettled=ea,E.prototype.allSettled=function(){return this.then(function(a){return ba(k(a,function(a){function b(){return a.inspect()}return a=A(a),a.then(b,b)}))})},A.fail=A.catch=function(a,b){return A(a).then(void 0,b)},E.prototype.fail=E.prototype.catch=function(a){return this.then(void 0,a)},A.progress=fa,E.prototype.progress=function(a){return this.then(void 0,void 0,a)},A.fin=A.finally=function(a,b){return A(a).finally(b)},E.prototype.fin=E.prototype.finally=function(a){return a=A(a),this.then(function(b){return a.fcall().then(function(){return b})},function(b){return a.fcall().then(function(){throw b})})},A.done=function(a,b,c,d){return A(a).done(b,c,d)},E.prototype.done=function(a,b,c){var d=function(a){A.nextTick(function(){if(t(a,e),!A.onerror)throw a;A.onerror(a)})},e=a||b||c?this.then(a,b,c):this;"object"==typeof process&&process&&process.domain&&(d=process.domain.bind(d)),e.then(void 0,d)},A.timeout=function(a,b,c){return A(a).timeout(b,c)},E.prototype.timeout=function(a,b){var c=B(),d=setTimeout(function(){b&&"string"!=typeof b||(b=new Error(b||"Timed out after "+a+" ms"),b.code="ETIMEDOUT"),c.reject(b)},a);return this.then(function(a){clearTimeout(d),c.resolve(a)},function(a){clearTimeout(d),c.reject(a)},c.notify),c.promise},A.delay=function(a,b){return void 0===b&&(b=a,a=void 0),A(a).delay(b)},E.prototype.delay=function(a){return this.then(function(b){var c=B();return setTimeout(function(){c.resolve(b)},a),c.promise})},A.nfapply=function(a,b){return A(a).nfapply(b)},E.prototype.nfapply=function(a){var b=B(),c=h(a);return c.push(b.makeNodeResolver()),this.fapply(c).fail(b.reject),b.promise},A.nfcall=function(a){var b=h(arguments,1);return A(a).nfapply(b)},E.prototype.nfcall=function(){var a=h(arguments),b=B();return a.push(b.makeNodeResolver()),this.fapply(a).fail(b.reject),b.promise},A.nfbind=A.denodeify=function(a){var b=h(arguments,1);return function(){var c=b.concat(h(arguments)),d=B();return c.push(d.makeNodeResolver()),A(a).fapply(c).fail(d.reject),d.promise}},E.prototype.nfbind=E.prototype.denodeify=function(){var a=h(arguments);return a.unshift(this),A.denodeify.apply(void 0,a)},A.nbind=function(a,b){var c=h(arguments,2);return function(){function f(){return a.apply(b,arguments)}var d=c.concat(h(arguments)),e=B();return d.push(e.makeNodeResolver()),A(f).fapply(d).fail(e.reject),e.promise}},E.prototype.nbind=function(){var a=h(arguments,0);return a.unshift(this),A.nbind.apply(void 0,a)},A.nmapply=A.npost=function(a,b,c){return A(a).npost(b,c)},E.prototype.nmapply=E.prototype.npost=function(a,b){var c=h(b||[]),d=B();return c.push(d.makeNodeResolver()),this.dispatch("post",[a,c]).fail(d.reject),d.promise},A.nsend=A.nmcall=A.ninvoke=function(a,b){var c=h(arguments,2),d=B();return c.push(d.makeNodeResolver()),A(a).dispatch("post",[b,c]).fail(d.reject),d.promise},E.prototype.nsend=E.prototype.nmcall=E.prototype.ninvoke=function(a){var b=h(arguments,1),c=B();return b.push(c.makeNodeResolver()),this.dispatch("post",[a,b]).fail(c.reject),c.promise},A.nodeify=ga,E.prototype.nodeify=function(a){return a?void this.then(function(b){A.nextTick(function(){a(null,b)})},function(b){A.nextTick(function(){a(b)})}):this},A.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var ha=y();return A});
